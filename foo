
create or replace function acc_div_fn(numeric[], numeric, numeric) returns numeric[] as $$
  select ARRAY[$1[1] + ($2 / $3), $1[2] + 1.0]
$$ language sql;

create or replace function avgx(numeric[]) returns numeric as $$
  select $1[1] / $1[2];
$$ language sql;

create aggregate avg_div(numeric, numeric) (
  sfunc = acc_div_fn,
  stype = numeric[],
  finalfunc = avgx,
  initcond = '{0.0, 0.0}'
);
